<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>JavaScript进阶学习（三）—— 基于html5 File API文件操作 | 小青年博客 | 看似寻常最奇崛，成如容易却艰辛。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="JavaScript,blob,File,FileReader,DataURI,URL">
    <meta name="description" content="写在前面这段时间一直有朋友在问文件上传下载的事，搜一下论坛发现相关的问题不少，但是不够系统，本着为人民服务的态度本文试着将一些问题整理一下，争取用初学者可以更明确的去处理相关的问题。文件上传是开发中绕不过的一个坎儿，对于很多没有经验的人来说，简直懵逼，目前我所知道的上传方式有下面这几种：  传统flash上传 隐藏iframe框上传 表单数据提交 HTML5的新工具——File API  本文限于">
<meta name="keywords" content="JavaScript,blob,File,FileReader,DataURI,URL">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript进阶学习（三）—— 基于html5 File API文件操作">
<meta property="og:url" content="https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/index.html">
<meta property="og:site_name" content="小青年博客">
<meta property="og:description" content="写在前面这段时间一直有朋友在问文件上传下载的事，搜一下论坛发现相关的问题不少，但是不够系统，本着为人民服务的态度本文试着将一些问题整理一下，争取用初学者可以更明确的去处理相关的问题。文件上传是开发中绕不过的一个坎儿，对于很多没有经验的人来说，简直懵逼，目前我所知道的上传方式有下面这几种：  传统flash上传 隐藏iframe框上传 表单数据提交 HTML5的新工具——File API  本文限于">
<meta property="og:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816001.png">
<meta property="og:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816002.png">
<meta property="og:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816003.png">
<meta property="og:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816004.png">
<meta property="og:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816005.png">
<meta property="og:updated_time" content="2017-05-03T16:15:01.556Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript进阶学习（三）—— 基于html5 File API文件操作">
<meta name="twitter:description" content="写在前面这段时间一直有朋友在问文件上传下载的事，搜一下论坛发现相关的问题不少，但是不够系统，本着为人民服务的态度本文试着将一些问题整理一下，争取用初学者可以更明确的去处理相关的问题。文件上传是开发中绕不过的一个坎儿，对于很多没有经验的人来说，简直懵逼，目前我所知道的上传方式有下面这几种：  传统flash上传 隐藏iframe框上传 表单数据提交 HTML5的新工具——File API  本文限于">
<meta name="twitter:image" content="http://oo1uw74rb.bkt.clouddn.com/20160816001.png">
    
        <link rel="alternate" type="application/atom+xml" title="小青年博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">赵梦欢</h5>
          <a href="mailto:zhaomenghuan@foxmail.com" title="zhaomenghuan@foxmail.com" class="mail">zhaomenghuan@foxmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://zhaomenghuan.github.io/content.json" target="_blank" >
                <i class="icon icon-lg icon-th-large"></i>
                API
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhaomenghuan" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                GitHub
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://segmentfault.com/u/zhaomenghuan" target="_blank" >
                <i class="icon icon-lg icon-link"></i>
                Segmentfault
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.jianshu.com/u/de1f0b8eaf18" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">JavaScript进阶学习（三）—— 基于html5 File API文件操作</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">JavaScript进阶学习（三）—— 基于html5 File API文件操作</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-08-15T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2016-08-16
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript进阶学习/">JavaScript进阶学习</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#写在前面"><span class="post-toc-number">1.</span> <span class="post-toc-text">写在前面</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#File-API"><span class="post-toc-number">2.</span> <span class="post-toc-text">File API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#通过input-file标签选择文件"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">通过input file标签选择文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#通过拖放操作选择文件"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">通过拖放操作选择文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#FileReader-API"><span class="post-toc-number">3.</span> <span class="post-toc-text">FileReader API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DataURI对象"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">DataURI对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#URL对象"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">URL对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FileReader-API详解"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">FileReader API详解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#状态常量"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">状态常量</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#属性"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">属性</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#方法"><span class="post-toc-number">3.3.3.</span> <span class="post-toc-text">方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#事件处理"><span class="post-toc-number">3.3.4.</span> <span class="post-toc-text">事件处理</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#blob-二进制大对象"><span class="post-toc-number">4.</span> <span class="post-toc-text">blob 二进制大对象</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Blob-构造函数生成blob对象"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Blob 构造函数生成blob对象</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#用JS在浏览器中创建下载文件"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">用JS在浏览器中创建下载文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Blob对象的slice方法生成blob对象"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Blob对象的slice方法生成blob对象</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考文档"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考文档</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-JavaScript进阶学习（三）—基于html5 File API文件操作"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">JavaScript进阶学习（三）—— 基于html5 File API文件操作</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-08-16 00:00:00" datetime="2016-08-15T16:00:00.000Z"  itemprop="datePublished">2016-08-16</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript进阶学习/">JavaScript进阶学习</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这段时间一直有朋友在问文件上传下载的事，搜一下论坛发现相关的问题不少，但是不够系统，本着为人民服务的态度本文试着将一些问题整理一下，争取用初学者可以更明确的去处理相关的问题。文件上传是开发中绕不过的一个坎儿，对于很多没有经验的人来说，简直懵逼，目前我所知道的上传方式有下面这几种：</p>
<ul>
<li>传统flash上传</li>
<li>隐藏iframe框上传</li>
<li>表单数据提交</li>
<li>HTML5的新工具——File API</li>
</ul>
<p>本文限于篇幅先介绍最后一种使用html5 File API进行文件上传的相关细节。</p>
<blockquote>
<p>历史上，JavaScript无法处理二进制数据。如果一定要处理的话，只能使用charCodeAt()方法，一个个字节地从文字编码转成二进制数据，还有一种办法是将二进制数据转成Base64编码，再进行处理。这两种方法不仅速度慢，而且容易出错。ECMAScript 5引入了Blob对象，允许直接操作二进制数据。Blob对象是一个代表二进制数据的基本对象，在它的基础上，又衍生出一系列相关的API，用来操作文件。</p>
</blockquote>
<h2 id="File-API"><a href="#File-API" class="headerlink" title="File API"></a>File API</h2><blockquote>
<p>File 接口提供了文件的信息，以及文件内容的存取方法。</p>
</blockquote>
<p>File对象可以用来获取某个文件的信息，还可以用来读取这个文件的内容。通常情况下，File对象是来自用户在一个&lt;input&gt;元素上选择文件后返回的FileList对象,也可以是来自由拖放操作生成的 DataTransfer对象.</p>
<h3 id="通过input-file标签选择文件"><a href="#通过input-file标签选择文件" class="headerlink" title="通过input file标签选择文件"></a>通过input file标签选择文件</h3><p>默认的input file标签比较难看，需要自己改造，一般无非是将input file设置宽高，然后使用overflow: hidden;将多余的部分隐藏，在上面再盖一个美化的按钮或者提示语，如下图：</p>
<p>浏览器原生的效果：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://oo1uw74rb.bkt.clouddn.com/20160816001.png" alt="origin" title="">
                </div>
                <div class="image-caption">origin</div>
            </figure>
<p>经过美化的效果：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://oo1uw74rb.bkt.clouddn.com/20160816002.png" alt="beautify" title="">
                </div>
                <div class="image-caption">beautify</div>
            </figure>
<p>代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></div><div class="line">			*&#123;</div><div class="line">				margin: 0px;</div><div class="line">				padding: 0px;</div><div class="line">			&#125;</div><div class="line">			.filePicker&#123;</div><div class="line">				width: 160px;</div><div class="line">				height: 44px;</div><div class="line">				line-height: 44px;</div><div class="line">				text-align: center;</div><div class="line">				color: #fff;</div><div class="line">				background: #00b7ee;		</div><div class="line">			&#125;</div><div class="line">			.filePicker input[type="file"] &#123;</div><div class="line">				position: relative;</div><div class="line">				top: -44px;</div><div class="line">				left: 0px;</div><div class="line">				width: 160px;</div><div class="line">				height: 44px;</div><div class="line">				opacity: 0;</div><div class="line">				cursor: pointer;</div><div class="line">				overflow: hidden;</div><div class="line">				z-index: 0;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			.container&#123;</div><div class="line">				width: 160px;</div><div class="line">				margin: 30px auto;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span>	</div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"filePicker"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>点击选择文件<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"fileInput"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">multiple</span>=<span class="string">"multiple"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>我们可以通过给input file标签设置accept属性进行文件选择过滤，该属性的值必须为一个逗号分割的列表,包含了多个唯一的内容类型声明：</p>
<ul>
<li>以 STOP 字符 (U+002E) 开始的文件扩展名。（例如：”.jpg,.png,.doc”）</li>
<li>一个有效的 MIME 类型，但没有扩展名</li>
<li>audio/* 表示音频文件 HTML5</li>
<li>video/* 表示视频文件 HTML5</li>
<li>image/* 表示图片文件</li>
</ul>
<p>设置multiple属性可以进行设置是单选还是多选。</p>
<p>通过File API,我们可以在用户选取一个或者多个文件之后,访问到代表了所选文件的一个或多个File对象，这些对象被包含在一个FileList对象中。所有type属性(attribute)为file的&lt;input&gt;元素都有一个files属性，用来存储用户所选择的文件。files有一个length属性和item方法，我们可以通过files[index]或者files.item(index)获取我们选择的file对象。可以通过change事件监听input file输入完成事件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">"fileInput"</span>);</div><div class="line">fileInput.addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> file = fileInput.files[<span class="number">0</span>];</div><div class="line">	<span class="comment">// 或file = fileInput.files.item(0);</span></div><div class="line">	<span class="built_in">console</span>.log(file);</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure></p>
<p>File API提供File对象，它是FileList对象的成员，包含了文件的一些元信息，比如文件名、上次改动时间、文件大小和文件类型。下图File对象的属性：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://oo1uw74rb.bkt.clouddn.com/20160816003.png" alt="file" title="">
                </div>
                <div class="image-caption">file</div>
            </figure>
<ul>
<li>lastModifiedDate：文件对象最后修改的日期</li>
<li>name：文件名,只读字符串,不包含任何路径信息.</li>
<li>size：文件大小,单位为字节,只读的64位整数.</li>
<li>type：MIME类型,只读字符串,如果类型未知,则返回空字符串.</li>
</ul>
<p>例如：我们可以根据size换算出我们习惯的文件大小表达方式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 读文件大小</div><div class="line"> * @param &#123;Object&#125; file</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFileSize</span>(<span class="params">file</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> size = file.size / <span class="number">1024</span>;</div><div class="line">	<span class="keyword">var</span> aMultiples = [<span class="string">"KB"</span>, <span class="string">"MB"</span>, <span class="string">"GB"</span>, <span class="string">"TB"</span>, <span class="string">"PB"</span>, <span class="string">"EB"</span>, <span class="string">"ZB"</span>, <span class="string">"YB"</span>];</div><div class="line">	</div><div class="line">	<span class="keyword">var</span> fileSizeString = <span class="string">''</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; size &gt; <span class="number">1</span>; size /= <span class="number">1024</span>, i++) &#123;</div><div class="line">	   fileSizeString = size.toFixed(<span class="number">2</span>) + <span class="string">" "</span> + aMultiples[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> fileSizeString;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有时候我们希望限制用户上传的文件大小，可以通过这个方法先做判断。同时我们可以通过type属性判断用户的文件类型，但是这种方法不可靠，因为用户可以通过改变后缀名实现。</p>
<p>很多新手企图通过input file标签获得文件完整路径，由于浏览器安全机制，这个是不被允许的，但是有时候我们希望选择完图片预览一下图片，这个时候我们就可以用FileReader API实现。</p>
<h3 id="通过拖放操作选择文件"><a href="#通过拖放操作选择文件" class="headerlink" title="通过拖放操作选择文件"></a>通过拖放操作选择文件</h3><p><strong>预览效果</strong>：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://oo1uw74rb.bkt.clouddn.com/20160816004.png" alt="drop" title="">
                </div>
                <div class="image-caption">drop</div>
            </figure>
<p><strong>代码实现</strong>：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></div><div class="line">			.dropbox&#123;</div><div class="line">				width: 300px;</div><div class="line">				height: 300px;</div><div class="line">				margin: 20px;</div><div class="line">    			border: 3px dashed #e6e6e6;</div><div class="line">			&#125;</div><div class="line">			.area&#123;</div><div class="line">				margin: 100px auto;</div><div class="line">				width: 100px;</div><div class="line">				height: 100px;</div><div class="line">				background-repeat: no-repeat;</div><div class="line">				background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABLCAIAAAB7tddWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1Q0VBNzA0MjEyMDUxMUUzODk2Q0JFM0Q1RjE4QkExQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1Q0VBNzA0MzEyMDUxMUUzODk2Q0JFM0Q1RjE4QkExQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAzNDA2MkY1MTIwMzExRTM4OTZDQkUzRDVGMThCQTFDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAzNDA2MkY2MTIwMzExRTM4OTZDQkUzRDVGMThCQTFDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+K6izdgAAAvpJREFUeNrsnFmPqkAQhWmX667gEp9c/v+/MkSDG+4LrvdcSYgRbw/0ALZQ9WBUJOn+uqvqHGCG3e93hUJRUoSAQBAIAkEgCASBIBAE4neRicEcII51Xb/dbnjPGOt0OqlUKok7ApN3jIKwY6DUIBAEgkAQCALho/X47TeXy8U0TcuyrtdrZKPs9/v2m8FgINYgf9QX/gTV+Xw2DCNKBJKmxmKxsAVc0kEcDgfyGq8CNp/Pa5qWy+WiHG6v13v7/XPt6Ha7Al5D3HQ1Go1sNkvtU8lkMsmtESSoCASBSFqEW/DQ0tbr9W63O51OKK6FQkFV1XQ6nSwQ0OOTyQSvjknZbDaA0mq1QCQafSFFasxmM4eCE1Do0+lUQrcSFggsPhzq20NgsVqtkpIax+MxMs+C/aXruvMxaonND75J9W5hUWWxuYAVdRfTg8EplUphGJywQPAFuBd5Dlhw/aDwwgVtCDgCdzph1QisG+dosVjkn44WYxjGC4XnvBuNRtvt9gtA2Hv47SGsZKVS4ef8eDzG4vMVCrpSgEU3xPbZbDar1erLl1AQ7XabU8xAAXvB3XffBnIHwkR2QcUYq9fr5XIZOxkTg6BEkeNLKdQF7AWPFBy1AoUmu8RG/HmE91nxM+J/ORIr07VcLvf7feCt+stAQGIBRNJtOJolDAhdj/hXGj5+u+TzIKAF+MbkK00XFta2BhDRUE0/9gv8Elogbu4TBW8+nyPhHSeuaVqtVuNQC6TzyQUCXsg0TbfyAxfIKogr9ynP1GJyYQZ57qbg7AuIRfclKZwSlDqWBQSmxM9zFALYh+fFBwJJSkNgqeFxSrAPw+EQ9QJew7Is2Sj8FgSW2nu1gylYPkKRMsRTA+4IcjA2fxsnDkLOq/IfACFP54uP1yAQBIJAEIh4gWCPkHk+GJ7AjU/fICJ+qlIghEfoDwQMtRjvyLYDRih4rsDT+bBM9tP5kuhrzN++e6SqqvCdYUb/SIO6BoEgEASCQBAIAkEgCEQg8VeAAQAB1bbO2qoeewAAAABJRU5ErkJggg==");</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			#preview img&#123;</div><div class="line">				width: 100px;</div><div class="line">				height: 100px;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dropbox"</span> <span class="attr">class</span>=<span class="string">"dropbox"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"area"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"preview"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		</div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> dropbox = <span class="built_in">document</span>.getElementById(<span class="string">"dropbox"</span>);</div><div class="line">			<span class="keyword">var</span> preview = <span class="built_in">document</span>.getElementById(<span class="string">"preview"</span>);</div><div class="line">			</div><div class="line">			dropbox.addEventListener(<span class="string">"dragenter"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">				e.stopPropagation();</div><div class="line">			  	e.preventDefault();</div><div class="line">			&#125;, <span class="literal">false</span>);</div><div class="line">			</div><div class="line">			dropbox.addEventListener(<span class="string">"dragover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">				e.stopPropagation();</div><div class="line">			  	e.preventDefault();</div><div class="line">			&#125;, <span class="literal">false</span>);</div><div class="line">			</div><div class="line">			dropbox.addEventListener(<span class="string">"drop"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">				e.stopPropagation();</div><div class="line">			  	e.preventDefault();</div><div class="line">			</div><div class="line">			  	<span class="keyword">var</span> dt = e.dataTransfer;</div><div class="line">			  	<span class="keyword">var</span> files = dt.files;</div><div class="line">			  	</div><div class="line">			  	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</div><div class="line">				    <span class="keyword">var</span> file = files[i];</div><div class="line">				    <span class="keyword">var</span> imageType = <span class="regexp">/^image\//</span>;</div><div class="line"></div><div class="line">				    <span class="keyword">if</span> ( !imageType.test(file.type) ) &#123;</div><div class="line">				      	<span class="keyword">continue</span>;</div><div class="line">				    &#125;</div><div class="line">				    </div><div class="line">				    <span class="comment">// 填充选择的图片到展示区</span></div><div class="line">				    <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">				    img.classList.add(<span class="string">"obj"</span>);</div><div class="line">				    img.file = file;</div><div class="line">				    preview.appendChild(img);</div><div class="line">				    </div><div class="line">				    <span class="comment">// 读取File对象中的内容</span></div><div class="line">				    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">				    reader.onload = (<span class="function"><span class="keyword">function</span>(<span class="params">aImg</span>) </span>&#123; </div><div class="line">				      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; </div><div class="line">				        aImg.src = e.target.result; </div><div class="line">				      &#125;; </div><div class="line">				    &#125;)(img);</div><div class="line">				    reader.readAsDataURL(file);</div><div class="line">				&#125;</div><div class="line">			&#125;, <span class="literal">false</span>);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在这个例子中，ID 为 dropbox 的元素所在的区域是我们的拖放目的区域。我们需要在该元素上绑定 dragenter，dragover，和drop 事件。我们必须阻止dragenter和dragover事件的默认行为，这样才能触发 drop 事件。我们从drop 事件对象中获取到dataTransfer对象，这个对象包含Filelist对象。</p>
<h2 id="FileReader-API"><a href="#FileReader-API" class="headerlink" title="FileReader API"></a>FileReader API</h2><blockquote>
<p>使用FileReader对象,web应用程序可以异步的读取存储在用户计算机上的文件(或者原始数据缓冲)内容,可以使用File对象或者Blob对象来指定所要处理的文件或数据.其中File对象可以是来自用户在一个&lt;input&gt;元素上选择文件后返回的FileList对象,也可以来自拖放操作生成的 DataTransfer对象,还可以是来自在一个HTMLCanvasElement上执行mozGetAsFile()方法后的返回结果。</p>
</blockquote>
<h3 id="DataURI对象"><a href="#DataURI对象" class="headerlink" title="DataURI对象"></a>DataURI对象</h3><p>在上面通过拖放操作选择文件的例子中，我们使用了”data:image/png;base64,xxxxxxxxxxxxx”这种形式的字符串作为背景，而不是图片，选择的图片展示也是使用这种形式。这种字符串叫做DataURI对象，允许将一个小文件进行编码后嵌入到另外一个文档里，格式为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data:[&lt;MIME type&gt;][;charset=&lt;charset&gt;][;base64],&lt;encoded data&gt;</div></pre></td></tr></table></figure></p>
<p>整体可以视为三部分，即声明：参数+数据，逗号左边的是各种参数，右边的是数据。</p>
<p>URL是uniform resource locator的缩写，在web中的每一个可访问资源都有一个URL地址，例如图片，HTML文件，js文件以及style sheet文件，我们可以通过这个地址去download这个资源。其实URL是URI的子集，URI是uniform resource identifier的缩写。URI是用于获取资源，包括其附加的信息的一种协议。附加信息可能是地址，也可能不是地址，如果是地址，那么这时URI就变成URL了。注意的是data URI不是URL，因为它并不包含资源的公共地址。</p>
<p>我们可以通过FileReader 的readAsDataURL方法获得：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.result);</div><div class="line">&#125;</div><div class="line">reader.readAsDataURL(file);</div></pre></td></tr></table></figure></p>
<p>有时候我们需要将DataURI对象转blob对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * dataURI 转 blob</div><div class="line"> * @param &#123;Object&#125; dataURI</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURItoBlob</span>(<span class="params">dataURI</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> arr = dataURI.split(<span class="string">','</span>), mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Blob([atob(arr[<span class="number">1</span>])], &#123;<span class="attr">type</span>:mime&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="URL对象"><a href="#URL对象" class="headerlink" title="URL对象"></a>URL对象</h3><p>我们除了可以使用base64字符串作为内容的DataURI将一个文件嵌入到另外一个文档里，还可以使用URL对象。URL对象用于生成指向File对象或Blob对象的URL。</p>
<blockquote>
<p>window.URL.createObjectURL</p>
</blockquote>
<p>静态方法会创建一个 DOMString，它的 URL 表示参数中的对象。这个 URL 的生命周期和创建它的窗口中的 document 绑定。这个新的URL 对象表示着指定的 File 对象或者 Blob 对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> objecturl =  <span class="built_in">window</span>.URL.createObjectURL(file);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>window.URL.revokeObjectURL</p>
</blockquote>
<p>静态方法用来释放一个之前通过调用 window.URL.createObjectURL() 创建的已经存在的 URL 对象。当你结束使用某个 URL 对象时，应该通过调用这个方法来让浏览器知道不再需要保持这个文件的引用了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.URL.revokeObjectURL(objecturl)</div></pre></td></tr></table></figure></p>
<p>例如：使用对象URL来显示图片：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">img.src = <span class="built_in">window</span>.URL.createObjectURL(blob);</div><div class="line">img.height = <span class="number">60</span>;</div><div class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">window</span>.URL.revokeObjectURL(<span class="keyword">this</span>.src);</div><div class="line">&#125;</div><div class="line"><span class="built_in">document</span>.body.appendChild(img);</div></pre></td></tr></table></figure></p>
<h3 id="FileReader-API详解"><a href="#FileReader-API详解" class="headerlink" title="FileReader API详解"></a>FileReader API详解</h3><h4 id="状态常量"><a href="#状态常量" class="headerlink" title="状态常量"></a>状态常量</h4><ul>
<li><strong>EMPTY</strong>：值为0，还没有加载任何数据;</li>
<li><strong>LOADING</strong>：值为0，数据正在被加载;</li>
<li><strong>DONE</strong>：值为0，已完成全部的读取请求。</li>
</ul>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul>
<li><strong>error</strong>：在读取文件时发生的错误， 只读;</li>
<li><strong>readyState</strong>：表明FileReader对象的当前状态，值为State constants中的一个，只读；</li>
<li><strong>result</strong>：取到的文件内容，这个属性只在读取操作完成之后才有效,并且数据的格式取决于读取操作是由哪个方法发起的，只读。</li>
</ul>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul>
<li><strong>abort()</strong>：中止该读取操作.在返回时,readyState属性的值为DONE.</li>
<li><strong>readAsArrayBuffer()</strong>：开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个ArrayBuffer对象以表示所读取文件的内容.</li>
<li><strong>readAsBinaryString()</strong>：开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含所读取文件的原始二进制数据.</li>
<li><strong>readAsDataURL()</strong>：开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容.</li>
<li><strong>readAsDataURL()</strong>：开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容.</li>
<li><strong>readAsText()</strong>：开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个字符串以表示所读取的文件内容.</li>
</ul>
<h4 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h4><ul>
<li><strong>onabort</strong>：当读取操作被中止时调用.</li>
<li><strong>onerror</strong>：当读取操作发生错误时调用.</li>
<li><strong>onload</strong>：当读取操作成功完成时调用.</li>
<li><strong>onloadend</strong>：当读取操作完成时调用,不管是成功还是失败.该处理程序在onload或者onerror之后调用.</li>
<li><strong>onloadstart</strong>：当读取操作将要开始之前调用.</li>
<li><strong>onprogress</strong>：在读取数据过程中周期性调用.</li>
</ul>
<p><strong>上传实例</strong>：以二进制流上传文件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">"fileInput"</span>);</div><div class="line">fileInput.addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> file = fileInput.files[<span class="number">0</span>];</div><div class="line">    <span class="keyword">if</span> (file) &#123;</div><div class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();  </div><div class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        xhr.onprogress=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> percentage = <span class="built_in">Math</span>.round((e.loaded * <span class="number">100</span>) / e.total);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"percentage:"</span>+percentage);</div><div class="line">        &#125;</div><div class="line">        xhr.onload=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"percentage:100"</span>);</div><div class="line">        &#125;</div><div class="line">        xhr.open(<span class="string">"POST"</span>, <span class="string">"这里填写服务器地址"</span>);  </div><div class="line">        reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">            xhr.send(evt.target.result);</div><div class="line">        &#125;;</div><div class="line">        reader.readAsBinaryString(file);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="blob-二进制大对象"><a href="#blob-二进制大对象" class="headerlink" title="blob 二进制大对象"></a>blob 二进制大对象</h2><p>BLOB (binary large object)，二进制大对象，是一个可以存储二进制文件的容器。</p>
<blockquote>
<p>创建Blob对象的方法有几种，可以调用Blob构造函数，还可以使用一个已有Blob对象上的slice()方法切出另一个Blob对象，还可以调用canvas对象上的toBlob方法。</p>
</blockquote>
<p>第一次见到这个词是半年之前，那个时候居然没有听过blob，然后上网查了一下，巴拉巴拉一大堆，当时是不理解的。</p>
<p>看了前面的一系列API和对象，或许很多同学开始晕了，但是在一开始说到的blob对象，我们一直没有提到，如果本文不提及，显然是不合理的。毕竟作为File对象的爸爸，blob劳苦功高。上述的FileReader对象也可以操作blob对象。</p>
<p>Blob对象有两个只读属性：</p>
<ul>
<li>size：二进制数据的大小，单位为字节。</li>
<li>type：二进制数据的MIME类型，全部为小写，如果类型未知，则该值为空字符串。<br>在Ajax操作中，如果xhr.responseType设为blob，接收的就是二进制数据。</li>
</ul>
<h3 id="Blob-构造函数生成blob对象"><a href="#Blob-构造函数生成blob对象" class="headerlink" title="Blob 构造函数生成blob对象"></a>Blob 构造函数生成blob对象</h3><p>Blob构造函数，接受两个参数。第一个参数是一个包含实际数据的数组，第二个参数是数据的类型，这两个参数都不是必需的。数组元素可以是任意多个的ArrayBuffer，ArrayBufferView (typed array)， Blob，或者 DOMString对象。<br>例如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="string">'&lt;h1&gt;hello world&lt;/h1&gt;'</span>];</div><div class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob(arr, &#123; <span class="string">"type"</span> : <span class="string">"text/xml"</span> &#125;); <span class="comment">// the blob</span></div><div class="line"><span class="built_in">console</span>.log(blob);</div></pre></td></tr></table></figure></p>
<p>效果如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://oo1uw74rb.bkt.clouddn.com/20160816005.png" alt="blob" title="">
                </div>
                <div class="image-caption">blob</div>
            </figure>
<h4 id="用JS在浏览器中创建下载文件"><a href="#用JS在浏览器中创建下载文件" class="headerlink" title="用JS在浏览器中创建下载文件"></a>用JS在浏览器中创建下载文件</h4><p>前端很多项目中，都有文件下载的需求，特别是JS生成文件内容，然后让浏览器执行下载操作（例如在线图片编辑、在线代码编辑、iPresst等）但受限于浏览器，很多情况下我们都只能给出个链接，让用户点击打开-》另存为。如下面这个链接：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"file.js"</span>&gt;</span>file.js<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>用户点击这个链接的时候，浏览器会打开并显示链接指向的文件内容，显然，这并没有实现我们的需求。HTML5中给a标签增加了一个download属性，只要有这个属性，点击这个链接时浏览器就不在打开链接指向的文件，而是改为下载（目前只有chrome、firefox和opera支持）。下载时会直接使用链接的名字来作为文件名，但是是可以改的，只要给download加上想要的文件名即可，如：<code>download=&quot;not-a-file.js&quot;</code>。但是这样还不够，以上的方法只适合用在文件是在服务器上的情况。如果在浏览器端js生成的内容，想让浏览器进行下载要如何办到呢？DataURI可以实现这个效果，但是DataURI的文件类型被限制了，我们这里可以变通一下实现blob对象。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"aLink"</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span> (<span class="params">el, fileName, content</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> aLink = <span class="built_in">document</span>.querySelector(el);</div><div class="line">	    <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([content]);	    		</div><div class="line">	    aLink.download = fileName;</div><div class="line">	    aLink.href = URL.createObjectURL(blob);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">document</span>.querySelector(<span class="string">'#aLink'</span>).addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	    downloadFile(<span class="string">'#aLink'</span>, <span class="string">'hello.txt'</span>, <span class="string">'&lt;h1&gt;hello world&lt;/h1&gt;'</span>);</div><div class="line">	&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="Blob对象的slice方法生成blob对象"><a href="#Blob对象的slice方法生成blob对象" class="headerlink" title="Blob对象的slice方法生成blob对象"></a>Blob对象的slice方法生成blob对象</h3><p>Blob对象的slice方法，将二进制数据按照字节分块，返回一个新的Blob对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> newBlob = oldBlob.slice(startingByte, endindByte);</div></pre></td></tr></table></figure></p>
<p>下面是一个使用XMLHttpRequest对象，将大文件分割上传的例子。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">blobOrFile</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  xhr.open(<span class="string">'POST'</span>, <span class="string">'/server'</span>, <span class="literal">true</span>);</div><div class="line">  xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; ... &#125;;</div><div class="line">  xhr.send(blobOrFile);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.querySelector(<span class="string">'input[type="file"]'</span>).addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> blob = <span class="keyword">this</span>.files[<span class="number">0</span>];</div><div class="line"></div><div class="line">  <span class="keyword">const</span> BYTES_PER_CHUNK = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 1MB chunk sizes.</span></div><div class="line">  <span class="keyword">const</span> SIZE = blob.size;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> start = <span class="number">0</span>;</div><div class="line">  <span class="keyword">var</span> end = BYTES_PER_CHUNK;</div><div class="line"></div><div class="line">  <span class="keyword">while</span>(start &lt; SIZE) &#123;</div><div class="line">    upload(blob.slice(start, end));</div><div class="line"></div><div class="line">    start = end;</div><div class="line">    end = start + BYTES_PER_CHUNK;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Using_files_from_web_applications" target="_blank" rel="external">在web应用中使用文件</a></li>
<li><a href="http://aiyouu.net/data-uris-explained/" target="_blank" rel="external">DataURI详解</a></li>
<li><a href="http://javascript.ruanyifeng.com/htmlapi/file.html" target="_blank" rel="external">文件和二进制数据的操作</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2013/10/understand-domstring-document-formdata-blob-file-arraybuffer/" target="_blank" rel="external">理解DOMString、Document、FormData、Blob、File、ArrayBuffer数据类型</a></li>
<li><a href="http://www.jb51.net/article/47723.htm" target="_blank" rel="external">用JS在浏览器中创建下载文件</a></li>
</ul>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-05-03T16:15:01.556Z" itemprop="dateUpdated">2017-05-04 00:15:01</time>
</span><br>


        
        转载需标注本文原始地址：<a href="/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/" target="_blank" rel="external">https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/</a>
        
    </div>
    <footer>
        <a href="https://zhaomenghuan.github.io">
            <img src="/img/avatar.png" alt="赵梦欢">
            赵梦欢
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DataURI/">DataURI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/File/">File</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FileReader/">FileReader</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/URL/">URL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blob/">blob</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&title=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&pic=https://zhaomenghuan.github.io/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&title=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&source=小青年,小青年博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&via=https://zhaomenghuan.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/08/17/录音文件与Base64编码相互转换的方法/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">录音文件与Base64编码相互转换的方法</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/08/05/mui组件通用CSS类/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">mui组件通用CSS类</h4>
      </a>
    </div>
  
</nav>



    













</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢老铁~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechat.png" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.png" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>赵梦欢 &copy; 2015 - 2017</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&title=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&pic=https://zhaomenghuan.github.io/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&title=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&source=小青年,小青年博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JavaScript进阶学习（三）—— 基于html5 File API文件操作》 — 小青年博客&url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/&via=https://zhaomenghuan.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhaomenghuan.github.io/2016/08/16/JavaScript进阶学习（三）—基于html5 File API文件操作/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD3klEQVR42u3a22obUQwF0Pz/T6fQp5YSe2tLE1JYfgqJfWa0JiDr8vERvz5/v/78OX99dcL05+SvX73n+IUDBw4cOIJQ82C6c/49c/8YknfmMeLAgQMHjluO5FZefypB7FLyJvg8Rhw4cODA8f0cXcAJx2vWPJHnjxMHDhw4cPwEji6hdq26rtWIAwcOHDh+Dkdy+TykffLuxlfTM3HgwIEDxxMc3fjn//r58f0OHDhw4MAxXEG4ag4m70xOmKbbKCIcOHDgwHGTHMblWT4i2ie//LN58fnmHnDgwIEDx5rj9cemoXYDoS7s7iG9jggHDhw4cGw49kOdaaE1XYDLz3ldUkZpGwcOHDhwPMYxXWWYJrausZh/a5guXrxJtDhw4MCBo+nmRc24PIDpaCpH774Q5HeLAwcOHDj2HF166xLneL1gEeS0mMSBAwcOHHuOPLHlF9gXWl0BthmA/VXR4sCBAweOBcd+TWGwMbHmnhaNm8SMAwcOHDg6jm7Ak19sX851KwvlqAwHDhw4cKw58kIoL8/2w6G8DNsgrupCHDhw4MAxhJguNCRh5K26q4Q9blziwIEDB441RzdMmo5zpq3GbnWvewBR6sWBAwcOHEccHdyb1tuipOzWI/Jr4cCBAweOW4588L8povJkPGXNz4/+CXDgwIEDx4JjOjSalljTYVWeDvMgB+MoHDhw4MCx4NisnV21BZNSrVu2mDY0ceDAgQPHnmPfyEsC6M7PV+Wu7hAHDhw4cOw5uiS3ab1tSrW8jXiwOYgDBw4cOCqOrn7pGoXTdmR3zpQ72u/AgQMHDhwxR95imybCq7LwiVFW9L+AAwcOHDiOOJKb2KwaTMPoWordAAwHDhw4cOw5ksIpT7pd8y5Pq2cJ9fV7cODAgQPHEcc0sG4gNF1W6O7kbCMDBw4cOHAcoXTFT9cinBaHXSpdzd9w4MCBA8eQo1tEyDmeCyNpSo4fGA4cOHDgWHMkH87HPNNgErjkr93wDAcOHDhw3HJ0S3JJquvGRdNhUldefnkmDhw4cOA44rjtMk6xuiZgXsLlQywcOHDgwLHnmB49va084Ns1i+lVcODAgQPHFcfn8LW56e730y8B0/dEFS0OHDhw4GhqokFCmrYU89beNKnnaxPTa+HAgQMHjs21kuQ6HefkZ3ZrEw8mWhw4cODAccSRJ6qukOvadlPQ5IrlLA4HDhw4cHwLx359IW87Tu+qrGVx4MCBA8c3cnRDo82qRHKtbhCFAwcOHDie5ugaedO0lyfCaWLOk/GbE3DgwIEDxwPrC11I08Q8Tc/5w9t8UcCBAwcOHAuOX1KIucwDKoA0AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1261860158&web_id=1261860158')

</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '小青年博客！';
            clearTimeout(titleTime);
        } else {
            document.title = '看似寻常最奇崛，成如容易却艰辛。';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



<script type="text/javascript">
    (function(p,u,s,h){
        p._pcq=p._pcq||[];
        p._pcq.push(['_currentTime',Date.now()]);
        s=u.createElement('script');
        s.type='text/javascript';
        s.async=true;
        s.src='https://cdn.pushcrew.com/js/84781173feeb9c46759523538d7dbfe0.js';
        h=u.getElementsByTagName('script')[0];
        h.parentNode.insertBefore(s,h);
    })(window,document);
</script>

</body>
</html>
